# –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´ –° –†–ï–ì–ò–°–¢–†–ê–¶–ò–ï–ô

## –ü—Ä–æ–±–ª–µ–º–∞:
–ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (—Ç–∞–±–ª–∏—Ü—É `profiles`).

## –ü—Ä–∏—á–∏–Ω–∞:
Supabase —Å–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ç–æ–ª—å–∫–æ –≤ —Ç–∞–±–ª–∏—Ü–µ `auth.users`, –Ω–æ –Ω–µ –≤ –Ω–∞—à–µ–π —Ç–∞–±–ª–∏—Ü–µ `profiles`.

## –†–µ—à–µ–Ω–∏–µ:
–î–æ–±–∞–≤–ª–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç—Ä–∏–≥–≥–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.

## –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ SQL:

### 1. –§—É–Ω–∫—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è:
```sql
CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS TRIGGER AS $$
BEGIN
    INSERT INTO public.profiles (id, email, full_name, gov_role, faction)
    VALUES (
        NEW.id,
        NEW.email,
        COALESCE(NEW.raw_user_meta_data->>'full_name', '–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'),
        'PROSECUTOR',
        'LSPD'
    );
    RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;
```

### 2. –¢—Ä–∏–≥–≥–µ—Ä –Ω–∞ —Ç–∞–±–ª–∏—Ü—É auth.users:
```sql
CREATE TRIGGER on_auth_user_created
    AFTER INSERT ON auth.users
    FOR EACH ROW EXECUTE FUNCTION public.handle_new_user();
```

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è** —á–µ—Ä–µ–∑ Supabase Auth
2. **–°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å** –≤ —Ç–∞–±–ª–∏—Ü–µ `auth.users`
3. **–°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä** `on_auth_user_created`
4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è** –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `profiles`
5. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç** —Ä–æ–ª—å `PROSECUTOR` –∏ —Ñ—Ä–∞–∫—Ü–∏—é `LSPD`

## –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

### –í —Ñ–æ—Ä–º–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¥–æ–±–∞–≤—å—Ç–µ –ø–æ–ª–µ `full_name` –∏ –ø–µ—Ä–µ–¥–∞–π—Ç–µ –µ–≥–æ –≤ `user_metadata`:

```javascript
const { data, error } = await supabase.auth.signUp({
  email: 'user@example.com',
  password: 'password123',
  options: {
    data: {
      full_name: '–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤'  // –≠—Ç–æ –ø–æ–ª–µ –ø–æ–ø–∞–¥–µ—Ç –≤ –ø—Ä–æ—Ñ–∏–ª—å
    }
  }
})
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞:

1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π SQL —Ñ–∞–π–ª `NEW_DATABASE_SETUP_FIXED.sql`
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É `profiles` - –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∏—Ç —Ä–æ–ª—å –∏ —Ñ—Ä–∞–∫—Ü–∏—é

## –†–µ–∑—É–ª—å—Ç–∞—Ç:
–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –∫–∞–∂–¥–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö! üéâ
