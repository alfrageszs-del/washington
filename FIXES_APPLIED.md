# Исправления системы юридических документов

## Проблемы, которые были исправлены:

### 1. Кнопка "Создать дело" не работала
- **Проблема**: Кнопка была статичной, без функциональности
- **Решение**: Добавлена полная функциональность создания дел с модальной формой
- **Файл**: `app/cases/page.tsx`

### 2. Нельзя было публиковать акты суда
- **Проблема**: Отсутствовала функциональность создания актов
- **Решение**: Добавлена форма создания актов суда прямо на странице
- **Файл**: `app/acts-court/page.tsx`

### 3. Нельзя было создавать расписание судов
- **Проблема**: Отсутствовала функциональность создания заседаний
- **Решение**: Добавлена форма создания судебных заседаний
- **Файл**: `app/court-sessions/page.tsx`

### 4. Проблемы с правами доступа
- **Проблема**: Неправильные политики безопасности в базе данных
- **Решение**: Создан SQL-скрипт для исправления политик
- **Файл**: `fix_access_policies.sql`

## Новые возможности:

### Создание дел
- Полная форма создания дел с валидацией
- Автоматическое создание событий для дел
- Проверка прав доступа (прокуроры, судьи, генеральный прокурор, главный судья)

### Создание актов суда
- Форма создания судебных актов
- Выбор статуса (черновик/опубликован)
- Проверка прав доступа (судьи, главный судья, тех. админ)

### Создание судебных заседаний
- Форма планирования заседаний
- Календарный вид и список
- Проверка прав доступа (судьи, главный судья, тех. админ)

## Что нужно сделать для полного исправления:

### 1. Выполнить SQL-скрипт
```bash
# Подключиться к базе данных и выполнить:
psql -d your_database -f fix_access_policies.sql
```

### 2. Проверить права пользователей
Убедиться, что у пользователей правильно установлены роли в таблице `profiles`:
- `JUDGE` - для судей
- `PROSECUTOR` - для прокуроров
- `ATTORNEY_GENERAL` - для генерального прокурора
- `CHIEF_JUSTICE` - для главного судьи
- `TECH_ADMIN` - для технических администраторов

### 3. Проверить структуру таблиц
Убедиться, что все необходимые таблицы существуют:
- `cases` - дела
- `court_acts` - акты суда
- `court_sessions` - судебные заседания
- `case_participants` - участники дел
- `case_documents` - документы дел
- `case_events` - события дел

## Дополнительные улучшения:

### 1. Добавлены отдельные страницы создания
- `/cases/new` - создание нового дела
- `/acts-court/new` - создание нового акта суда
- `/court-sessions/new` - создание нового заседания

### 2. Улучшенный UI/UX
- Модальные формы для быстрого создания
- Валидация полей
- Информативные сообщения об ошибках
- Адаптивный дизайн

### 3. Безопасность
- Проверка прав доступа на уровне компонентов
- RLS (Row Level Security) в базе данных
- Правильные политики безопасности

## Тестирование:

После применения исправлений проверьте:

1. **Создание дел**: Войдите как прокурор или судья, попробуйте создать дело
2. **Создание актов**: Войдите как судья, попробуйте создать акт суда
3. **Создание заседаний**: Войдите как судья, попробуйте создать заседание
4. **Просмотр**: Проверьте, что все пользователи могут просматривать опубликованные документы

## Примечания:

- Все формы имеют валидацию на клиенте и сервере
- Добавлена обработка ошибок
- Реализована навигация между страницами
- Сохранена совместимость с существующим кодом
