# –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö WASHINGTON

## –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –¥–ª—è —Å–∏—Å—Ç–µ–º—ã WASHINGTON. –í—Å–µ —Ñ–∞–π–ª—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Å–æ–∑–¥–∞–Ω—ã –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

## –ü–æ—Ä—è–¥–æ–∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –®–∞–≥ 1: –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
# –ü—Ä–∏–º–µ–Ω—è–µ–º –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ö–µ–º—É
psql -d your_database -f database_schema.sql
```

### –®–∞–≥ 2: –û—Å–Ω–æ–≤–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–í–µ—Ä—Å–∏—è 2)
```bash
# –ü—Ä–∏–º–µ–Ω—è–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏ 2
psql -d your_database -f fix_database_issues_v2.sql
```

### –®–∞–≥ 3: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å role_change_requests
```bash
# –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–æ–±–ª–µ–º—É —Å requested_faction_value
psql -d your_database -f fix_role_change_requests.sql
```

### –®–∞–≥ 4: –°–æ–∑–¥–∞–Ω–∏–µ ENUM'–æ–≤ –¥–ª—è –≤—Å–µ—Ö —Ä–æ–ª–µ–π
```bash
# –°–æ–∑–¥–∞–µ–º ENUM'—ã –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
psql -d your_database -f database_enums.sql
```

### –®–∞–≥ 5: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ ENUM'–æ–≤ –∫ —Ç–∞–±–ª–∏—Ü–∞–º
```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ–º ENUM'—ã –∫–æ –≤—Å–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –ø–æ–ª—è–º
psql -d your_database -f apply_enums_to_tables_complete.sql
```

## –û–ø–∏—Å–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### 1. `fix_database_issues_v2.sql`
**–†–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã:**
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ñ—É–Ω–∫—Ü–∏—è `handle_new_user`)
- ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö (`status`, `created_at`, `current_faction_value`, `current_role_value`)
- ‚úÖ –°–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ (`cases.prosecutor_id`, `cases.judge_id`, `inspections.inspector_id`)
- ‚úÖ –î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `lawyers`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ RLS –ø–æ–ª–∏—Ç–∏–∫

### 2. `fix_role_change_requests.sql`
**–†–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É:**
- ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∞—è –∫–æ–ª–æ–Ω–∫–∞ `requested_faction_value` –≤ —Ç–∞–±–ª–∏—Ü–µ `role_change_requests`
- ‚úÖ –û—à–∏–±–∫–∞ "Could not find the 'requested_faction_value' column of 'role_change_requests' in the schema cache"

### 3. `database_enums.sql`
**–°–æ–∑–¥–∞–µ—Ç ENUM'—ã –¥–ª—è:**
- ‚úÖ –î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã (`department_enum`)
- ‚úÖ –§—Ä–∞–∫—Ü–∏–∏ (`faction_enum`)
- ‚úÖ –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–æ–ª–∏ (`gov_role_enum`)
- ‚úÖ –õ–∏–¥–µ—Ä—Å–∫–∏–µ —Ä–æ–ª–∏ (`leader_role_enum`)
- ‚úÖ –°—Ç–∞—Ç—É—Å—ã –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π (`appointment_status_enum`)
- ‚úÖ –°—Ç–∞—Ç—É—Å—ã –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ (`verification_status_enum`)
- ‚úÖ –¢–∏–ø—ã –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ (`verification_kind_enum`)
- ‚úÖ –¢–∏–ø—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–æ–ª–µ–π (`role_change_request_type_enum`)
- ‚úÖ –°—Ç–∞—Ç—É—Å—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–æ–ª–µ–π (`role_change_request_status_enum`)
- ‚úÖ –¢–∏–ø—ã –æ—Ä–¥–µ—Ä–æ–≤ (`warrant_type_enum`)
- ‚úÖ –°—Ç–∞—Ç—É—Å—ã –æ—Ä–¥–µ—Ä–æ–≤ (`warrant_status_enum`)
- ‚úÖ –°—Ç–∞—Ç—É—Å—ã —à—Ç—Ä–∞—Ñ–æ–≤ (`fine_status_enum`)
- ‚úÖ –°—Ç–∞—Ç—É—Å—ã –∏–Ω—Å–ø–µ–∫—Ü–∏–π (`inspection_status_enum`)
- ‚úÖ –°—Ç–∞—Ç—É—Å—ã –¥–µ–ª (`case_status_enum`)
- ‚úÖ –°—Ç–∞—Ç—É—Å—ã –∞–¥–≤–æ–∫–∞—Ç–æ–≤ (`lawyer_status_enum`)
- ‚úÖ –°—Ç–∞—Ç—É—Å—ã –∞–∫—Ç–æ–≤ (`act_status_enum`)

### 4. `apply_enums_to_tables_complete.sql` (–ü–û–õ–ù–ê–Ø –†–ê–ë–û–ß–ê–Ø –í–ï–†–°–ò–Ø - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø)
**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç ENUM'—ã –∫:**
- ‚úÖ **profiles** - faction, gov_role, leader_role, office_role
- ‚úÖ **appointments** - department, status
- ‚úÖ **verification_requests** - kind, status
- ‚úÖ **role_change_requests** - request_type, status
- ‚úÖ **gov_acts** - status
- ‚úÖ **court_acts** - status
- ‚úÖ **warrants** - warrant_type, status
- ‚úÖ **cases** - status
- ‚úÖ **court_sessions** - status
- ‚úÖ **lawyers** - status
- ‚úÖ **lawyer_requests** - status
- ‚úÖ **lawyer_contracts** - status
- ‚úÖ **inspections** - status
- ‚úÖ **fines** - issuer_faction, status

**üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–µ–π, –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –∫–æ–ª–æ–Ω–∫–∏ —Å –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

**üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 
- –°–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª—è–µ—Ç RLS –ø–æ–ª–∏—Ç–∏–∫–∏, –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫–æ–ª–æ–Ω–∫–∏, –∑–∞—Ç–µ–º –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–æ–ª–∏—Ç–∏–∫–∏
- **–ò–°–ü–†–ê–í–õ–ï–ù–û:** –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–∞–∑–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫ (`created_by` vs `requested_by` vs `user_id`)
- **–ò–°–ü–†–ê–í–õ–ï–ù–û:** –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü –±–µ–∑ –∫–æ–ª–æ–Ω–∫–∏ `created_by`

**üìã –ü–æ–ª–Ω–æ—Ç–∞:** –û–±–Ω–æ–≤–ª—è–µ—Ç –í–°–ï –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –≤–æ –í–°–ï–• —Ç–∞–±–ª–∏—Ü–∞—Ö

**üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏:**
- `ERROR: 42703: column "created_by" does not exist` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –¥–ª—è `role_change_requests` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç `requested_by`)
- `ERROR: 42703: column "created_by" does not exist` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –¥–ª—è `lawyer_requests` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç `user_id`)
- `ERROR: 42703: column "created_by" does not exist` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –¥–ª—è `lawyer_contracts` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç `client_id`)

## –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

### üîß **–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `profiles`
2. **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏** - `status`, `created_at`, `current_faction_value`, `current_role_value`
3. **–°–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏** - –æ—à–∏–±–∫–∏ "Could not find a relationship between..."
4. **–ó–∞–ø—Ä–æ—Å—ã –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–æ–ª–µ–π** - –æ—à–∏–±–∫–∏ —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏ `requested_faction_value`
5. **–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã "–î–µ–ª–∞"** - –∏–∑–º–µ–Ω–µ–Ω —Å "–°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞" –Ω–∞ "–î–µ–ª–∞"

### üéØ **–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏:**
- `column gov_acts.status does not exist`
- `column court_acts.status does not exist`
- `column fines.created_at does not exist`
- `Could not find the 'current_faction_value' column of 'role_change_requests' in the schema cache`
- `Could not find the 'current_role_value' column of 'role_change_requests' in the schema cache`
- `Could not find the 'requested_faction_value' column of 'role_change_requests' in the schema cache`
- `Could not find a relationship between 'cases' and 'profiles' in the schema cache`
- `Could not find a relationship between 'inspections' and 'profiles' in the schema cache`

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### üõ°Ô∏è **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- –í—Å–µ —Ñ–∞–π–ª—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `DO $$` –±–ª–æ–∫–∏ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫
- –ü—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –æ–ø–µ—Ä–∞—Ü–∏–π
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `DROP ... IF EXISTS` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã (–±–µ–∑–æ–ø–∞—Å–Ω—ã –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏)

### üîÑ **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –§–∞–π–ª—ã –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ –±–µ–∑ –≤—Ä–µ–¥–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç –æ—à–∏–±–∫–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- –í—Å–µ –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –≤—ã —É–≤–∏–¥–∏—Ç–µ:
- ‚úÖ –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫
- ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ `handle_new_user`
- ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–∞ `on_auth_user_created`
- ‚úÖ –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–≤—è–∑–µ–π –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏
- ‚úÖ –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö ENUM'–æ–≤
- ‚úÖ –°—Ç–∞—Ç—É—Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è ENUM'–æ–≤ –∫–æ –≤—Å–µ–º —Ç–∞–±–ª–∏—Ü–∞–º
- ‚úÖ –°–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—à–Ω–æ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- PostgreSQL 9.2 –∏–ª–∏ –≤—ã—à–µ (–¥–ª—è `DROP ... IF EXISTS`)
- –ü—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π, —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –∏ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ –∏–∑ `database_schema.sql`

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- **–ü–æ—Ä—è–¥–æ–∫ –≤–∞–∂–µ–Ω** - —Ñ–∞–π–ª—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **ENUM'—ã** —Å–æ–∑–¥–∞—é—Ç—Å—è –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∞–∑—ã
- **–í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è** —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
- **–ü—Ä–æ–≤–µ—Ä–∫–∏** –≤—Å—Ç—Ä–æ–µ–Ω—ã –≤ –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã "–î–µ–ª–∞" –∏–∑–º–µ–Ω–µ–Ω —Å "–°—É–¥–µ–±–Ω—ã–µ –¥–µ–ª–∞" –Ω–∞ "–î–µ–ª–∞"
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ SQL —Å—Ö–µ–º–µ –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è
- –í—Å–µ —Ç–∏–ø—ã –∏–∑ `supabase/client.ts` —Ç–µ–ø–µ—Ä—å –∏–º–µ—é—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ ENUM'—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ ENUM'–æ–≤

### üéØ **–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:**
- **–°—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è** - –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î** - –æ—à–∏–±–∫–∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç—Å—è –¥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** - –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º —Ç–∏–ø–∞–º

### üöÄ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- **–ë—ã—Å—Ç—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã** - ENUM'—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏–π
- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã** - –ª—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- **–ú–µ–Ω—å—à–µ –º–µ—Å—Ç–∞** - ENUM'—ã –∑–∞–Ω–∏–º–∞—é—Ç –º–µ–Ω—å—à–µ –º–µ—Å—Ç–∞ —á–µ–º TEXT

### üõ°Ô∏è **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- **–ó–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫** - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –æ–ø–µ—á–∞—Ç–æ–∫ –∏ –Ω–µ–≤–µ—Ä–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- **–í–∞–ª–∏–¥–∞—Ü–∏—è** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
- **–ê—É–¥–∏—Ç** - —á–µ—Ç–∫–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ –≤—Å–µ–º–∏ —Å–≤—è–∑—è–º–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ –∏ –±–µ–∑ –æ—à–∏–±–æ–∫ "column does not exist" –∏–ª–∏ "relationship not found". –í—Å–µ –ø–æ–ª—è —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å—Ç—Ä–æ–≥—É—é —Ç–∏–ø–∏–∑–∞—Ü–∏—é ENUM –≤–º–µ—Å—Ç–æ –ø—Ä–æ—Å—Ç—ã—Ö TEXT –ø–æ–ª–µ–π.

### üîç **–ï—Å–ª–∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –Ω–µ –æ–±–Ω–æ–≤–∏–ª–∏—Å—å:**

–ï—Å–ª–∏ –≤ –≤—ã–≤–æ–¥–µ `apply_enums_to_tables.sql` –≤—ã –≤–∏–¥–∏—Ç–µ "TEXT (needs update)" –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∫–æ–ª–æ–Ω–æ–∫, —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤ –Ω–∏—Ö –µ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è, –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ ENUM'–∞–º. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ** - –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –∫–∞–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∞—Ç—Å—è –≤ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∫–æ–ª–æ–Ω–∫–∞—Ö
2. **–û—á–∏—Å—Ç–∏—Ç–µ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è** - –∑–∞–º–µ–Ω–∏—Ç–µ –∏—Ö –Ω–∞ –¥–æ–ø—É—Å—Ç–∏–º—ã–µ –∏–ª–∏ NULL
3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ** - –æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç –∫–æ–ª–æ–Ω–∫–∏ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

### üìä **–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:**
```sql
-- –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –µ—Å—Ç—å –≤ –ø—Ä–æ–±–ª–µ–º–Ω–æ–π –∫–æ–ª–æ–Ω–∫–µ
SELECT DISTINCT faction FROM profiles WHERE faction IS NOT NULL;

-- –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, –∏—Å–ø—Ä–∞–≤–ª—è–µ–º –∏—Ö
UPDATE profiles SET faction = 'CIVILIAN' WHERE faction NOT IN ('CIVILIAN', 'GOV', 'COURT', 'WN', 'FIB', 'LSPD', 'LSCSD', 'EMS', 'SANG');
```
